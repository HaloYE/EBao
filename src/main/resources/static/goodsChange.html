<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改商品信息</title>
    <link rel="stylesheet" href="layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/Business.css">
    <script src="js/x-layui.js"></script>
    <script src="layuiadmin/layui/layui.js"></script>
    <script src="js/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container1"></div>
    <div class="container2">
        <div class="x-body">
            <form class="layui-form layui-form-pane"  id="addGoods">
                <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                    <div class="layui-tab-content" >
                        <div class="layui-tab-item layui-show">
                            <div class="layui-form-item">
                                <label class="layui-form-label">
                                    <span style="color: red">*</span>商品名称
                                </label>
                                <div class="layui-input-block">
                                    <input type="text" name="goodsName" id="goodsName" autocomplete="off" placeholder="输入商品名称"
                                           class="layui-input" onblur="checkgoodsName()">
                                    <span id="goodsNamespan" style="color: red"></span>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">
                                    <span style="color: red">*</span>商品种类
                                </label>
                                <div class="layui-input-block">
                                    <input type="text" name="goodsKind" id="goodsKind" autocomplete="off" placeholder="输入商品种类"
                                           class="layui-input" onblur="checkgoodsKind()">
                                    <span id="goodsKindspan" style="color: red"></span>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label needIn">商品展示图</label>
                                    <div class="layui-input-inline">
                                        <button type="button" class="layui-btn" id="sendImg">
                                            <i class="layui-icon">&#xe67c;</i>修改图片
                                        </button>
                                        <input type="text" name="goodsPicture" class="layui-input layui-hide" id="goodsPicture">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">展示图</label>
                                    <div class="layui-input-inline">
                                        <img class="layui-upload-img" id="demo1" style="width: 100px;height: 100px">
                                        <p id="demoText"></p>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">
                                    <span style="color: red">*</span>租用价格
                                </label>
                                <div class="layui-input-block">
                                    <input type="text" name="goodsPrice" id="goodsPrice" autocomplete="off" placeholder="输入商品租用价格"
                                           class="layui-input" onblur="checkgoodsPrice()">
                                    <span id="goodsPricespan" style="color: red"></span>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">
                                    <span style="color: red">*</span>商品押金
                                </label>
                                <div class="layui-input-block">
                                    <input type="text" name="deposit" id="deposit" autocomplete="off" placeholder="输入商品押金"
                                           class="layui-input" onblur="checkdeposit()">
                                    <span id="depositspan" style="color: red"></span>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <button class="layui-btn" lay-filter="addGoodsBtn" type="button" id="goodsAddBtn" onclick="changeGoods()">
                                    修改
                                </button>
                            </div>
                            <!--</form>-->
                            <div style="height:100px;"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="container3"></div>
</body>
<script>

    var rgoodsName=true;
    var rgoodsKind=true;
    var rgoodsPrice=true;
    var rdeposit=true;


    $(document).ready(function (){
        // var goodsId=localStorage.getItem("goodsId");
        var goodsName=localStorage.getItem("goodsName");
        var goodsPicture=localStorage.getItem("goodsPicture");
        var goodsKind=localStorage.getItem("goodsKind");
        // var shopId=localStorage.getItem("shopId");
        var goodsPrice=localStorage.getItem("goodsPrice");
        var deposit=localStorage.getItem("deposit");

        $("#goodsName").val(goodsName);
        $("#demo1").attr("src", goodsPicture);
        $("#goodsKind").val(goodsKind);
        $("#goodsPrice").val(goodsPrice);
        $("#deposit").val(deposit);

    })

    layui.use(['form', 'layer','upload','jquery'], function() {
        var form = layui.form;
        var $ = layui.jquery;
        var layer = layui.layer;
        var upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#sendImg'
            ,url: "../eBao/upload.action" //改成您自己的上传接口
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#demo1').attr('src', result); //图片链接（base64）
                    // console.log(result)
                });
            }
            ,done: function(res){
                //如果上传失败
                // alert(res.img_url);
                if (res.code==-1){
                    return layer.msg('上传失败')
                }
                if (res.code==0){
                    console.log(res.goodsPicture);
                    $("#goodsPicture").val(res.goodsPicture);
                    console.log($("#goodsPicture").val())
                    //上传成功
                }
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });

    });



    function checkgoodsName() {
        var goodsName = $("#goodsName").val()
        var reg_goodsName=/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/;
        var flag=reg_goodsName.test(goodsName);
        console.log(goodsName);
        if (goodsName == "") {
            rgoodsName=false;
            document.getElementById("goodsNamespan").innerHTML = "商品名称不能为空！";
            return false;
        }else if (flag==false){
            rgoodsName=false;
            document.getElementById("goodsNamespan").innerHTML = "商品名称不能有特殊字符！";
            return false;
        }
        else {
            rgoodsName=true;
            document.getElementById("goodsNamespan").innerText="";
            return true;
        }
    }

    function checkgoodsKind() {
        var goodsKind = $("#goodsKind").val()
        var reg_goodsKind=/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/;
        var flag=reg_goodsKind.test(goodsKind);
        console.log(goodsKind);
        if (goodsKind == "") {
            rgoodsKind=false;
            document.getElementById("goodsKindspan").innerHTML = "商品种类不能为空！";
            return false;
        }else if (flag==false){
            rgoodsKind=false;
            document.getElementById("goodsKindspan").innerHTML = "商品种类不能有特殊字符！";
            return false;
        }
        else {
            rgoodsKind=true;
            document.getElementById("goodsKindspan").innerText="";
            return true;
        }
    }

    function checkgoodsPrice() {
        var goodsPrice = $("#goodsPrice").val()
        var reg_goodsPrice=/^[1-9]\d*$/;
        var flag=reg_goodsPrice.test(goodsPrice);
        console.log(goodsPrice);
        if (goodsPrice == "") {
            rgoodsPrice=false;
            document.getElementById("goodsPricespan").innerHTML = "商品价格不能为空！";
            return false;
        }else if (flag==false){
            rgoodsPrice=false;
            document.getElementById("goodsPricespan").innerHTML = "商品价格不能有非数字！";
            return false;
        }else {
            rgoodsPrice=true;
            document.getElementById("goodsPricespan").innerText="";
            return true;
        }
    }

    function checkdeposit() {
        var deposit = $("#deposit").val()
        var reg_deposit=/^[1-9]\d*$/;
        var flag=reg_deposit.test(deposit);
        console.log(deposit);
        if (deposit == "") {
            rdeposit=false;
            document.getElementById("depositspan").innerHTML = "商品押金不能为空！";
            return false;
        }else if (flag==false){
            rdeposit=false;
            document.getElementById("depositspan").innerHTML = "商品押金不能有非数字！";
            return false;
        }else {
            rdeposit=true;
            document.getElementById("depositspan").innerText="";
            return true;
        }
    }

    function changeGoods(){
        if (rgoodsName&&rgoodsKind&&rgoodsPrice&&rdeposit){
            var goodsId=localStorage.getItem("goodsId");

            $.ajax({
                url:"../eBao/goodsChange.action",
                // type:"post",
                data: {"goodsId":goodsId,"goodsName":$("#goodsName").val(),"goodsKind":$("#goodsKind").val(),"goodsPicture":$("#goodsPicture").val(),"goodsPrice":$("#goodsPrice").val(),"deposit":$("#goodsPrice").val()},
                success:function (msg){
                    // console.log(goodsId+"1")
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                    parent.layer.open({
                        title: '修改成功'
                        ,icon:1
                        ,content: '修改成功！'
                    });
                    parent.table.reload('showGoodsTab');

                },
                error:function (){
                    // console.log(goodsId+"2")
                }
            })

            return true; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        }else {
            alert("请检查输入是否正确!")
        }
            // var data=obj.data;
            // var mydata = data.field;
            // console.log(mydata+"33")

    }
</script>
</html>